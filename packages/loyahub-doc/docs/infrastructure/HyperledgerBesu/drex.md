---
sidebar_position: 2
---

# DREX Environment Simulation


### What is DREX?

DREX (Digital Real) is the Central Bank Digital Currency (CBDC) project of Brazil. It's a digital representation of the Brazilian Real, issued and backed by the Central Bank of Brazil (BCB). DREX aims to modernize the financial system, enhance financial inclusion, and facilitate more efficient and secure transactions.

### How DREX Works

1. **Blockchain Technology**: DREX is built on a permissioned blockchain network, utilizing Hyperledger Besu with the IBFT 2.0 consensus mechanism.

2. **Two-Tier System**: 
   - The Central Bank issues DREX to authorized financial institutions.
   - These institutions then distribute DREX to end-users (individuals and businesses).

3. **Smart Contracts**: DREX leverages smart contracts for programmable money features, enabling automated and conditional transactions.

4. **Interoperability**: It's designed to work seamlessly with existing payment systems and potentially with other CBDCs in the future.

### Central Bank of Brazil's Implementation Plan

1. **Pilot Phase**: 
   - The BCB is currently running a pilot program with selected financial institutions and tech companies.
   - This phase tests various use cases and technical aspects of DREX.

2. **Infrastructure Development**:
   - Building a robust, scalable blockchain network.
   - Implementing strong security measures and privacy protections.

3. **Regulatory Framework**:
   - Developing and refining regulations to govern DREX issuance and usage.
   - Ensuring compliance with existing financial laws and international standards.

4. **Integration with Financial System**:
   - Working with banks and payment providers to integrate DREX into existing systems.
   - Developing interfaces for easy adoption by businesses and consumers.

5. **Public Education and Awareness**:
   - Launching campaigns to educate the public about DREX and its benefits.
   - Providing training and resources for financial institutions.

6. **Gradual Rollout**:
   - After successful pilot tests, the BCB plans a phased rollout of DREX.
   - This will likely start with wholesale transactions between financial institutions before expanding to retail use.

The Central Bank of Brazil aims to leverage DREX to enhance financial inclusion, reduce transaction costs, and foster innovation in the Brazilian financial ecosystem. The project represents a significant step towards modernizing Brazil's monetary system for the digital age.



### Prerequisites

- **Docker** installed.
- **Docker Compose** installed.

### Project Structure

Organize your project as follows:

```bash
infra/
└── compose/
    └── besu/
        ├── data/
        │   ├── genesis.json  # Generated by the init.sh script
        │   ├── node1/
        │   │   └── data/
        │   ├── node2/
        │   │   └── data/
        │   ├── node3/
        │   │   └── data/
        │   └── node4/
        │       └── data/
        ├── docker-compose.yaml
        └── init.sh
```

## Docker Compose 

The docker-compose file to run without java and libs: 

```yaml
services:
  bootnode:
    container_name: bootnode
    image: hyperledger/besu:23.4.4
    user: "1000:1000"
    entrypoint: 
      - "/bin/bash"
      - "-c"
      - >
        sleep 10; 
        /opt/besu/bin/besu 
        --data-path=/opt/besu/data 
        --metrics-enabled 
        --metrics-host=0.0.0.0 
        --metrics-port=9545 
        --genesis-file=/opt/besu/genesis.json 
        --rpc-http-enabled 
        --rpc-ws-enabled 
        --rpc-ws-port=6174 
        --rpc-ws-host=0.0.0.0 
        --rpc-http-api=ETH,NET,QBFT,TXPOOL 
        --host-allowlist='*' 
        --rpc-http-cors-origins='all' 
        --rpc-http-port=8545 
        --rpc-http-host=0.0.0.0 
        --min-gas-price=0 
        --rpc-http-max-batch-size=10
    volumes:
      - ./data/genesis.json:/opt/besu/genesis.json
      - ./data/node1/data:/opt/besu/data
      - ./data:/data
    ports:
      - "8545:8545"
      - "30303:30303"
      - "6174:6174"
    networks:
      protocol:
        ipv4_address: 172.16.239.10

  validator_1:
    container_name: validator_1
    image: hyperledger/besu:23.4.4
    user: "1000:1000"
    entrypoint:
      - "/bin/bash"
      - "-c"
      - >
        sleep 10;
        /opt/besu/bin/besu 
        --data-path=/opt/besu/data 
        --metrics-enabled 
        --metrics-host=0.0.0.0 
        --metrics-port=9546 
        --genesis-file=/opt/besu/genesis.json 
        --bootnodes='enode://a50a100f8c28b181a07019ff1ecdfd9fb4ba33822a84e57f5e4dc339c16149cc03f7e5adcffcee7095a8419c83fc3923618cdb3d6f3985a26b4d983ba550ac1d@172.16.239.10:30303'
        --p2p-port=30304 
        --rpc-http-enabled 
        --rpc-ws-enabled 
        --rpc-ws-port=6175 
        --rpc-http-api=ETH,NET,IBFT,TXPOOL 
        --host-allowlist='*' 
        --rpc-http-cors-origins='all' 
        --rpc-http-port=8546 
        --rpc-http-host=0.0.0.0 
        --min-gas-price=0
    volumes:
      - ./data/genesis.json:/opt/besu/genesis.json
      - ./data/node2/data:/opt/besu/data
      - ./data/log-config.xml:/config/log-config.xml
    ports:
      - "8546:8546"
      - "30304:30304"
      - "6175:6175"
    depends_on:
      - bootnode
    networks:
      protocol:
        ipv4_address: 172.16.239.11

  validator_2:
    container_name: validator_2
    image: hyperledger/besu:23.4.4
    user: "1000:1000"
    entrypoint:
      - "/bin/bash"
      - "-c"
      - >
        sleep 10; 
        /opt/besu/bin/besu 
        --data-path=/opt/besu/data 
        --metrics-enabled 
        --metrics-host=0.0.0.0 
        --metrics-port=9547 
        --genesis-file=/opt/besu/genesis.json 
        --bootnodes='enode://a50a100f8c28b181a07019ff1ecdfd9fb4ba33822a84e57f5e4dc339c16149cc03f7e5adcffcee7095a8419c83fc3923618cdb3d6f3985a26b4d983ba550ac1d@172.16.239.10:30303'
        --p2p-port=30305 
        --rpc-http-enabled 
        --rpc-ws-enabled 
        --rpc-ws-port=6176 
        --rpc-http-api=ETH,NET,QBFT,TXPOOL 
        --host-allowlist='*' 
        --rpc-http-cors-origins='all' 
        --rpc-http-port=8547 
        --rpc-http-host=0.0.0.0 
        --min-gas-price=0
    volumes:
      - ./data/genesis.json:/opt/besu/genesis.json
      - ./data/node3/data:/opt/besu/data
      - ./data/log-config.xml:/config/log-config.xml
    ports:
      - "8547:8547"
      - "30305:30305"
      - "6176:6176"
    depends_on:
      - bootnode
    networks:
      protocol:
        ipv4_address: 172.16.239.12

  validator_3:
    container_name: validator_3
    image: hyperledger/besu:23.4.4
    user: "1000:1000"
    entrypoint:
      - "/bin/bash"
      - "-c"
      - >
        sleep 10; 
        /opt/besu/bin/besu 
        --data-path=/opt/besu/data 
        --metrics-enabled 
        --metrics-host=0.0.0.0 
        --metrics-port=9548 
        --genesis-file=/opt/besu/genesis.json 
        --bootnodes='enode://a50a100f8c28b181a07019ff1ecdfd9fb4ba33822a84e57f5e4dc339c16149cc03f7e5adcffcee7095a8419c83fc3923618cdb3d6f3985a26b4d983ba550ac1d@172.16.239.10:30303'
        --p2p-port=30306 
        --rpc-http-enabled 
        --rpc-ws-enabled 
        --rpc-ws-port=61747 
        --rpc-http-api=ETH,NET,QBFT,TXPOOL 
        --host-allowlist='*' 
        --rpc-http-cors-origins='all' 
        --rpc-http-port=8548 
        --rpc-http-host=0.0.0.0 
        --min-gas-price=0
    volumes:
      - ./data/genesis.json:/opt/besu/genesis.json
      - ./data/node4/data:/opt/besu/data
      - ./data/log-config.xml:/config/log-config.xml
    ports:
      - "8548:8548"
      - "30306:30306"
      - "61747:61747"
    depends_on:
      - bootnode
    networks:
      protocol:
        ipv4_address: 172.16.239.13

  explorer:
    container_name: explorer
    image: alethio/ethereum-lite-explorer
    ports:
      - "80:80"
    environment:
      - APP_NODE_URL=http://localhost:8545
    depends_on:
      - bootnode
    networks:
      - protocol

volumes:
  pnpm-store:
    driver: local

networks:
  protocol:
    name: protocol
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.239.0/24

```


### Running the Environment

To start the DREX simulation environment, follow these steps:

1. Navigate to the `infra/compose/besu` directory in your terminal.

2. Run the following command:

   ```bash
   docker-compose up -d
   ```

This command does the following:

- `-d`: Runs the containers in detached mode (in the background).
- `docker-compose up`: Builds, (re)creates, starts, and attaches to containers for a service.

When you run this command:

1. Docker Compose reads the `docker-compose.yml` file in the current directory.
2. It creates and starts the services defined in the file:
   - A bootnode (the initial node other nodes connect to)
   - Three validator nodes
   - An Ethereum blockchain explorer

3. The bootnode and validator nodes are Hyperledger Besu instances, each configured with specific parameters for the DREX network.
4. The explorer provides a web interface to view blockchain data.

5. Docker Compose sets up the specified network (`protocol`) and connects all services to it.

6. Volumes are created to persist data between container restarts.

After running this command, you'll have a fully functional DREX simulation environment with four Besu nodes forming a private blockchain network and an explorer to visualize the blockchain data.

To stop the environment, you can use:

